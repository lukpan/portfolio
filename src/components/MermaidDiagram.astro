---
const { diagram } = Astro.props;
---

<div class="mermaid-container">
  <pre class="mermaid">{diagram}</pre>
</div>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ 
    startOnLoad: true, 
    theme: 'dark',
    themeVariables: {
      darkMode: true,
      background: '#1a2234',
      primaryColor: '#f59e0b',
      primaryTextColor: '#f9fafb',
      primaryBorderColor: '#f59e0b',
      secondaryColor: '#fbbf24',
      secondaryTextColor: '#d1d5db',
      tertiaryColor: '#111827',
      tertiaryTextColor: '#9ca3af',
      lineColor: 'rgba(255, 255, 255, 0.2)',
      textColor: '#d1d5db',
      mainBkg: '#1a2234',
      secondBkg: '#111827',
      border1: 'rgba(245, 158, 11, 0.3)',
      border2: 'rgba(251, 191, 36, 0.2)',
      arrowheadColor: '#f59e0b',
      fontFamily: 'Manrope, -apple-system, BlinkMacSystemFont, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 60,
      curve: 'basis',
      padding: 20
    }
  });
</script>

<style>
  .mermaid-container {
    background: var(--color-bg-elevated, #1a2234);
    border: 1px solid var(--color-border-medium, rgba(255, 255, 255, 0.1));
    border-radius: 0.75rem;
    padding: clamp(1.5rem, 4vw, 3rem);
    margin: 3rem 0;
    overflow-x: auto;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
  }
  
  .mermaid-container::-webkit-scrollbar {
    height: 8px;
  }
  
  .mermaid-container::-webkit-scrollbar-track {
    background: var(--color-bg-secondary, #111827);
    border-radius: 4px;
  }
  
  .mermaid-container::-webkit-scrollbar-thumb {
    background: var(--color-accent-primary, #f59e0b);
    border-radius: 4px;
  }
  
  .mermaid-container::-webkit-scrollbar-thumb:hover {
    background: var(--color-accent-secondary, #fbbf24);
  }
  
  /* Ensure text is readable */
  .mermaid {
    display: flex;
    justify-content: center;
    min-height: 300px;
  }
  
  /* Improve accessibility */
  @media (prefers-reduced-motion: reduce) {
    .mermaid * {
      animation: none !important;
      transition: none !important;
    }
  }
  
  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .mermaid-container {
      padding: 1rem;
      margin: 2rem -1rem;
      border-radius: 0;
      border-left: none;
      border-right: none;
    }
  }
</style>
